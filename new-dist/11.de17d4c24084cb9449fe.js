webpackJsonp([11],{1203:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(o,a){try{var i=t[o](a),u=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}return r("next")})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l,c,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},f=function(){function e(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=n(1),h=r(p),y=n(115),m=n(185),v=n(491),b=(n(496),n(1218)),g=r(b),k=n(1217),_=r(k),w=n(1316),E=r(w),C=n(490),O=r(C),P=(l=(0,m.connect)(function(e,t){return{}},function(e){return{loadPostsList:(0,y.bindActionCreators)(v.loadPostsList,e)}}))(c=function(e){function t(e){a(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={posts:null,loading:!0},n.successCallback=n.successCallback.bind(n),n}return u(t,e),d(t,[{key:"componentDidMount",value:function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){var t,n,r,o,a,i,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.location.params.posts_id,n=this.props,r=n.loadPostsList,o=n.notFoundPgae,!t){e.next=12;break}return e.next=5,r({id:"edit_"+t,filters:{variables:{_id:t},select:"\n          _id\n          comment_count\n          content\n          content_html\n          create_at\n          deleted\n          device\n          follow_count\n          ip\n          last_comment_at\n          like_count\n          recommend\n          sort_by_date\n          title\n          topic_id{\n            _id\n            name\n          }\n          type\n          user_id{\n            _id\n            nickname\n            brief\n            avatar_url\n          }\n          verify\n          view_count\n          weaken\n          follow\n          like\n          "}});case 5:a=e.sent,i=f(a,2),u=i[0],l=i[1],l&&l.data&&l.data[0]?this.setState({loading:!1,posts:l.data[0]}):o("主题不存在"),e.next=13;break;case 12:this.setState({loading:!1});case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"successCallback",value:function(e){var t=this.props.location.params.posts_id;t?this.props.history.push("/posts/"+t):this.props.history.push("/posts/"+e._id)}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.posts;return t?h.default.createElement(O.default,null):h.default.createElement("div",null,h.default.createElement(_.default,{title:"创建帖子"}),n?h.default.createElement(E.default,s({successCallback:this.successCallback},n)):h.default.createElement(E.default,{successCallback:this.successCallback}))}}]),t}(h.default.Component))||c;t.default=(0,g.default)(P)},1217:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Meta=void 0;var u,l,c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),f=r(s),d=n(489),p=r(d),h=(n(115),n(185)),y=n(286),m=n(117),v=t.Meta=(u=(0,h.connect)(function(e,t){return{unreadNotice:(0,y.getUnreadNotice)(e)}},function(e){return{}}))(l=function(e){function t(e){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),c(t,[{key:"render",value:function(){var e={},t=this.props,n=t.title,r=t.description,o=t.canonical,a=t.meta,i=t.link,u=t.unreadNotice;return e.title=n?n+" - "+m.name:m.name,r&&(e.description=r),o&&(e.canonical=o),a&&(e.meta=a),i&&(e.link=i),u&&u.length>0&&(e.title="("+u.length+"条通知) "+e.title),f.default.createElement(p.default,null,f.default.createElement("title",null,u&&u.length>0?"("+u.length+"条通知)":"",n||m.name,n?" - "+m.name:""),this.props.children)}}]),t}(s.Component))||l;t.default=v},1218:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(o,a){try{var i=t[o](a),u=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}return r("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),f=r(s),d=n(115),p=n(185),h=n(1219),y=n(1220),m=n(488),v=r(m),b=n(487),g=r(b),k=function(e){var t,n,r;return e.loadData||(e.loadData=function(e){e.store,e.match;return new Promise(function(){var e=u(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({code:200});case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}())}),(0,p.connect)(function(e,t){return{}},function(e){return{saveScrollPosition:(0,d.bindActionCreators)(h.saveScrollPosition,e),setScrollPosition:(0,d.bindActionCreators)(h.setScrollPosition,e),addVisitHistory:(0,d.bindActionCreators)(y.addVisitHistory,e)}})((r=n=function(t){function n(e){o(this,n);var t=a(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={notFoundPgae:""},t}return i(n,t),c(n,[{key:"componentWillMount",value:function(){var e=this.props.location,t=(e.pathname,e.search);if(this.props.location.params=t?(0,g.default)(t):{},this.props.staticContext){var n=this.props.staticContext,r=n.code,o=n.text;404==r&&(this.state.notFoundPgae=o||"404 NOT FOUND")}}},{key:"componentDidMount",value:function(){var e=this.props.location,t=e.pathname,n=e.search;this.props.setScrollPosition(t+n),this.props.addVisitHistory(t+n)}},{key:"componentWillReceiveProps",value:function(e){this.props.location.pathname+this.props.location.search!=e.location.pathname+e.location.search&&(this.componentWillUnmount(),this.props=e,this.componentDidMount())}},{key:"componentWillUnmount",value:function(){var e=this.props.location,t=e.pathname,n=e.search;this.props.saveScrollPosition(t+n)}},{key:"render",value:function(){var t=this,n=this.state.notFoundPgae;return f.default.createElement("div",{className:"container"},n?f.default.createElement("div",null,n):f.default.createElement(e,l({},this.props,{notFoundPgae:function(e){t.setState({notFoundPgae:e||"404 NOT FOUND"})}})))}}]),n}(f.default.Component),n.defaultProps={loadData:function(t){var n=t.store,r=t.match;return new Promise(function(t,o){var a=[];v.default.loadData&&a.push(v.default.loadData({store:n,match:r})),e.loadData&&a.push(e.loadData({store:n,match:r})),Promise.all(a).then(function(n){t(e.loadData?n[n.length-1]:{code:200})})})}},t=r))||t};t.default=k},1219:function(e,t,n){"use strict";function r(e){return function(t,n){t({type:"SET_SCROLL_POSITION",name:e})}}function o(e){return function(t,n){t({type:"SAVE_SCROLL_POSITION",name:e})}}Object.defineProperty(t,"__esModule",{value:!0}),t.setScrollPosition=r,t.saveScrollPosition=o},1220:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.addVisitHistory=function(e){return function(t){t({type:"ADD_HISTORY",page:e})}}},1221:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){var e=function(){this.devices={1:"unknow",2:"windows",3:"mac",4:"ipad",5:"iphone",6:"android"},this.show={1:"",2:"",3:"",4:"来自 iPad",5:"来自 iPhone",6:"来自 Android"}};return e.prototype.getCurrentDeviceId=function(){if("undefined"==typeof window||"undefined"==typeof document)return 1;var e="unknow",t=navigator.platform,n=navigator.userAgent.toLowerCase(),r={windows:0==t.indexOf("Win"),mac:0==t.indexOf("Mac"),ipad:"ipad"==n.match(/ipad/i),iphone:"iphone os"==n.match(/iphone os/i),android:"android"==n.match(/android/i)};for(var o in r)r[o]&&(e=o);for(var o in this.devices)if(this.devices[o]==e)return o;return 1},e.prototype.getNameByDeviceId=function(e){return this.show[e]},e.prototype.isMobileDevice=function(){var e=this.getCurrentDeviceId();return 5==e||6==e},new e}();t.default=r},1235:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(o,a){try{var i=t[o](a),u=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}return r("next")})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.QiniuUploadImage=void 0;var l,c,s,f,d=function(){function e(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=n(1),y=r(h),m=n(1236),v=r(m),b=n(1238),g=(r(b),n(115)),k=n(185),_=n(1239),w=n(1240),E=(r(w),t.QiniuUploadImage=(l=(0,k.connect)(function(e,t){return{}},function(e){return{getQiNiuToken:(0,g.bindActionCreators)(_.getQiNiuToken,e)}}))((f=s=function(e){function t(e){a(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={loading:!1,files:[],token:"",url:"",uploadKey:""},n.onDrop=n._onDrop.bind(n),n.onUpload=n.onUpload.bind(n),n}return u(t,e),p(t,[{key:"componentDidMount",value:function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){var t,n,r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.getQiNiuToken,e.next=3,t();case 3:n=e.sent,r=d(n,2),o=r[0],a=r[1],a&&this.setState({token:a.token,url:a.url});case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"onUpload",value:function(e){var t=this,n=this.props,r=n.beforeUpload,o=n.upload,a=this.state.url;t.setState({loading:!0});var i=0;r(e),e.map(function(n){n.upload().then(function(r){r.text().then(function(r){r=JSON.parse(r),o(a+"/"+r.key,n),(i+=1)>=e.length&&t.setState({loading:!1})})})})}},{key:"_onDrop",value:function(e){(0,this.props.onDrop)(e)}},{key:"render",value:function(){if(!this.state.token)return y.default.createElement("span",null);var e=this.state,t=(e.loading,e.token,this.props),n=t.multiple,r=(t.name,t.displayLoading,t.text);return y.default.createElement(v.default,{text:r,multiple:n,accept:"image/*",token:this.state.token,onUpload:this.onUpload})}}]),t}(y.default.Component),s.defaultProps={displayLoading:!0,text:"上传图片",multiple:!0,beforeUpload:function(e){},upload:function(e){},onDrop:function(e){},onUpload:function(e){}},c=f))||c);t.default=E},1236:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,l,c,s,f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=n(1),p=r(d),h=n(78),y=r(h);n(493);var m=n(135),v=r(m),b=n(1237),g=r(b),k=(u=(0,v.default)(g.default))((s=c=function(e){function t(e){o(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={},n.onChange=n.onChange.bind(n),n.upload=n.upload.bind(n),n}return i(t,e),f(t,[{key:"onChange",value:function(e){e.preventDefault();var t=this,n=void 0;e.dataTransfer?n=e.dataTransfer.files:e.target&&(n=e.target.files);for(var r=this.props.multiple?n.length:1,o=[],a=0;a<r;a++)n[a].preview=URL.createObjectURL(n[a]),n[a].upload=function(e){return function(){return t.upload(e)}}(n[a]),o.push(n[a]);this.props.onUpload(o)}},{key:"upload",value:function(e){var t=this;if(!e||0===e.size)return null;var n=e.preview.split("/").pop()+"."+e.name.split(".").pop();return new Promise(function(r){var o=(document.querySelector('input[type="file"]'),new FormData);o.append("file",e),o.append("token",t.props.token),o.append("key",n),o.append("x:filename",e.name),o.append("x:size",e.size),fetch(t.props.uploadUrl,{method:"POST",body:o}).then(function(e){r(e)}).catch(function(e){r(e)})})}},{key:"render",value:function(){var e=this.props,t=e.text,n=e.accept,r=e.multiple;return p.default.createElement("a",{href:"javascript:void(0)",styleName:"file"},t,p.default.createElement("input",{type:"file",accept:n,multiple:r,onChange:this.onChange}))}}]),t}(p.default.Component),c.defaultProps={text:"上传图片",size:2097152,accept:"*",multiple:!0,uploadUrl:function(){return"undefined"==typeof window||"undefined"==typeof document?"":"https:"===window.location.protocol?"https://up.qbox.me/":"http://upload.qiniu.com"}(),onUpload:function(e){}},c.propTypes={token:y.default.string},l=s))||l;t.default=k},1237:function(e,t){e.exports={file:"_20RkjeJ1"}},1238:function(e,t){},1239:function(e,t,n){"use strict";function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(o,a){try{var i=t[o](a),u=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}return r("next")})}}function o(){var e=this;return function(t,n){return new Promise(function(){var t=r(regeneratorRuntime.mark(function t(r,o){var i,l,c,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.default)({api:"qiniuToken",fields:"\n          token\n          url\n        ",headers:{accessToken:n().user.accessToken}});case 2:i=e.sent,l=a(i,2),c=l[0],s=l[1],r(c?[c]:[null,s]);case 7:case"end":return e.stop()}},t,e)}));return function(e,n){return t.apply(this,arguments)}}())}}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.getQiNiuToken=o;var i=n(116),u=function(e){return e&&e.__esModule?e:{default:e}}(i)},1240:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Loading=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(1),c=r(l),s=(n(115),n(185),n(1241)),f=r(s),d=t.Loading=function(e){function t(e){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),u(t,[{key:"render",value:function(){return c.default.createElement("div",{className:f.default.loading},c.default.createElement("span",null))}}]),t}(l.Component);t.default=d},1241:function(e,t){e.exports={loading:"_1inE1j98"}},1244:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){switch(e.getType()){case"blockquote":return"RichEditor-blockquote";default:return null}}function l(e,t,n){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&"LINK"===n.getEntity(t).getType()},t)}Object.defineProperty(t,"__esModule",{value:!0}),t.MyEditor=void 0;var c,s,f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=n(1),p=r(d),h=n(56),y=(r(h),n(494)),m=n(495),v=r(m),b=n(1245),g=r(b),k=n(1235),_=r(k);n(1246),n(1247);var w=function(e){var t=e.contentState.getEntity(e.entityKey).getData(),n=t.url;return p.default.createElement("a",{href:n},e.children)},E=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.onToggle=function(t){t.preventDefault(),e.props.onToggle(e.props.style)},e}return i(t,e),f(t,[{key:"render",value:function(){var e="RichEditor-styleButton";return this.props.active&&(e+=" RichEditor-activeButton"),p.default.createElement("span",{className:e+" "+this.props.className,onMouseDown:this.onToggle})}}]),t}(p.default.Component),C=[{className:"title",label:"H2",style:"header-two"},{className:"blockquote",label:"Blockquote",style:"blockquote"},{className:"ul",label:"ul",style:"unordered-list-item"},{className:"code-block",label:"code",style:"code-block"}],O=[{className:"bold",label:"bold",style:"BOLD"},{className:"italic",label:"italic",style:"ITALIC"},{className:"underline",label:"underline",style:"UNDERLINE"}],P=function(e){var t=e.editorState,n=t.getSelection(),r=t.getCurrentContent().getBlockForKey(n.getStartKey()).getType(),o=e.editorState.getCurrentInlineStyle();return p.default.createElement("div",{className:"RichEditor-controls border-bottom"},e.expandControl&&C.map(function(t){return p.default.createElement(E,{key:t.label,active:t.style===r,label:t.label,onToggle:e.toggleBlockType,className:t.className,style:t.style})}),e.expandControl&&O.map(function(t){return p.default.createElement(E,{key:t.label,active:o.has(t.style),label:t.label,onToggle:e.toggleInlineStyle,className:t.className,style:t.style})}),p.default.createElement(_.default,{beforeUpload:function(t){var n=[];t.map(function(e){n.push({name:e.name,src:""})}),e.addImage(n)},upload:function(t,n){e.updateImage(t,n)},text:p.default.createElement("span",{className:"RichEditor-styleButton image"})}),e.expandControl?null:p.default.createElement("span",{onClick:e.handleExpandControl,className:"RichEditor-styleButton more"}),e.expandControl?p.default.createElement("span",{className:"RichEditor-styleButton link",onClick:e.addLink}):null)},S=function(e,t){return e.map(function(e,n){return[e,t?p.default.createElement("br",{key:t[n]}):p.default.createElement("br",null)]})},T={inline:{BOLD:function(e,t){var n=t.key;return p.default.createElement("strong",{key:n},e)},ITALIC:function(e,t){var n=t.key;return p.default.createElement("em",{key:n},e)},UNDERLINE:function(e,t){var n=t.key;return p.default.createElement("u",{key:n},e)},CODE:function(e,t){var n=t.key;return p.default.createElement("span",{key:n},e)}},blocks:{unstyled:function(e){return e.map(function(e,t){return p.default.createElement("p",{key:t},e)})},blockquote:function(e,t){var n=t.keys;return p.default.createElement("blockquote",{key:n[0]},S(e,n))},"header-one":function(e){return e.map(function(e,t){return p.default.createElement("h1",{key:t},e)})},"header-two":function(e){return e.map(function(e,t){return p.default.createElement("h2",{key:t},e)})},"code-block":function(e,t){var n=t.keys;return p.default.createElement("pre",{key:n[0]},S(e,n))},"unordered-list-item":function(e,t){var n=(t.depth,t.keys);return p.default.createElement("ul",{key:n[n.length-1]},e.map(function(e,t){return p.default.createElement("li",{key:n[t]},e)}))},"ordered-list-item":function(e,t){var n=(t.depth,t.keys);return p.default.createElement("ol",{key:n.join("|")},e.map(function(e,t){return p.default.createElement("li",{key:n[t]},e)}))},atomic:function(e,t){var n=t.keys;return S(e,n)}},entities:{youku:function(e,t,n){var r=n.key;return p.default.createElement("div",{key:r,"data-youku":t.src})},tudou:function(e,t,n){var r=n.key;return p.default.createElement("div",{key:r,"data-tudou":t.src})},qq:function(e,t,n){var r=n.key;return p.default.createElement("div",{key:r,"data-qq":t.src})},youtube:function(e,t,n){var r=n.key;return p.default.createElement("div",{key:r,"data-youtube":t.src})},image:function(e,t,n){var r=n.key;return p.default.createElement("img",{key:r,src:t.src})},"163-music-song":function(e,t,n){var r=n.key;return p.default.createElement("div",{key:r,"data-163musicsong":t.src})},"163-music-playlist":function(e,t,n){var r=n.key;return p.default.createElement("div",{key:r,"data-163musicplaylist":t.src})},LINK:function(e,t,n){var r=n.key;return p.default.createElement("a",{key:r,href:t.url,target:"_blank",rel:"nofollow"},e)}}},j=new y.CompositeDecorator([{strategy:l,component:w}]),x=t.MyEditor=(s=c=function(e){function t(e){o(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=n.props,i=r.syncContent,u=r.content,l=r.readOnly,c=r.placeholder,s=r.expandControl;return n.state={syncContent:i,readOnly:l,editorState:u?y.EditorState.createWithContent((0,y.convertFromRaw)(JSON.parse(u)),j):y.EditorState.createEmpty(j),rendered:null,placeholder:c,expandControl:s||!1},n.onChange=n._onChange.bind(n),n.toggleBlockType=function(e){return n._toggleBlockType(e)},n.toggleInlineStyle=function(e){return n._toggleInlineStyle(e)},n.addImage=n._addImage.bind(n),n.addLink=n._addLink.bind(n),n.updateImage=n._updateImage.bind(n),n.handleKeyCommand=n._handleKeyCommand.bind(n),n.mapKeyToEditorCommand=n._mapKeyToEditorCommand.bind(n),n.mediaBlockRenderer=n.mediaBlockRenderer.bind(n),n.media=n._media.bind(n),n.checkUpload=n.checkUpload.bind(n),n}return i(t,e),f(t,[{key:"componentDidMount",value:function(){this.onChange(this.state.editorState),this.props.getEditor(this.refs.editor),this.props.getCheckUpload(this.checkUpload)}},{key:"_onChange",value:function(e){this.setState({editorState:e},function(){});var t=this.state.syncContent,n=this.refs.draftHtml;if(t){var r=e.getCurrentContent(),o=(0,v.default)((0,y.convertToRaw)(r),T);this.setState({rendered:o}),setTimeout(function(){var e=n.innerHTML.replace(/<!--[\w\W\r\n]*?-->/gim,""),o=e.replace(/<p>/gim,"");if(!(o=o.replace(/<\/p>/gim,"")))return void t("","");t(JSON.stringify((0,y.convertToRaw)(r)),e)},100)}}},{key:"_toggleBlockType",value:function(e){this.onChange(y.RichUtils.toggleBlockType(this.state.editorState,e))}},{key:"_toggleInlineStyle",value:function(e){this.onChange(y.RichUtils.toggleInlineStyle(this.state.editorState,e))}},{key:"_addLink",value:function(e){var t=this.state.editorState;if(t.getSelection().isCollapsed())alert("请先选取需要添加链接的文字内容");else{var n=prompt("请输入url地址以http://或https://开头","");if(!n)return;var r=t.getCurrentContent(),o=r.createEntity("LINK","MUTABLE",{url:n}),a=o.getLastCreatedEntityKey(),i=y.EditorState.set(t,{currentContent:o});this.onChange(y.RichUtils.toggleLink(i,i.getSelection(),a))}}},{key:"_addImage",value:function(e){this._promptForMedia("image",e)}},{key:"_updateImage",value:function(e,t){var n=this,r=n.state.editorState,o=r.getCurrentContent();o.blockMap.map(function(n){n.findEntityRanges(function(n){var r=n.getEntity();if(r){if("image"==o.getEntity(r).getType()){var a=o.getEntity(r).getData();a.name==t.name&&(a.src=e,o.replaceEntityData(r,a))}}})}),n.refs.editor.blur(),n.refs.editor.focus()}},{key:"checkUpload",value:function(){var e=this,t=e.state.editorState,n=t.getCurrentContent(),r=!0;return n.blockMap.map(function(e){e.findEntityRanges(function(e){var t=e.getEntity();if(t){if("image"==n.getEntity(t).getType()){var o=n.getEntity(t).getData();o.name&&!o.src&&(r=!1)}}})}),r}},{key:"_promptForMedia",value:function(e,t){var n=this.state.editorState,r=n,o=null;t.map(function(e){var t=r.getCurrentContent(),n=t.createEntity("image","IMMUTABLE",e);o=n.getLastCreatedEntityKey();var a=y.AtomicBlockUtils.insertAtomicBlock(r,o," ");r=a}),this.onChange(r)}},{key:"_handleKeyCommand",value:function(e){var t=this.state.editorState,n=y.RichUtils.handleKeyCommand(t,e);return!!n&&(this.onChange(n),!0)}},{key:"_mapKeyToEditorCommand",value:function(e){switch(e.keyCode){case 9:var t=y.RichUtils.onTab(e,this.state.editorState,4);return void(t!==this.state.editorState&&this.onChange(t))}return(0,y.getDefaultKeyBinding)(e)}},{key:"_media",value:function(e){var t=this.state.editorState,n=t.getCurrentContent(),r=n.getEntity(e.block.getEntityAt(0)),o=r.getData(),a=o.src,i=r.getType(),u=void 0;if("link"===i)u=p.default.createElement("a",{href:a,target:"_blank",rel:"nofollow"},a);else if("image"===i)u=p.default.createElement("img",{src:a});else if("youtube"===i){var l="https://www.youtube.com/embed/"+a;u=p.default.createElement("iframe",{src:l})}else if("youku"===i){var c="https://player.youku.com/embed/"+a;u=p.default.createElement("iframe",{src:c})}else if("qq"===i){var s="https://v.qq.com/iframe/player.html?vid="+a+"&tiny=0&auto=0";u=p.default.createElement(g.default,{src:s,width:"auto",height:"auto",position:""})}else if("163-music-song"===i){var f="//music.163.com/outchain/player?type=2&id="+a+"&auto=1&height=66";u=p.default.createElement(g.default,{src:f,width:"auto",height:"86",position:""})}else if("163-music-playlist"===i){var d="//music.163.com/outchain/player?type=0&id="+a+"&auto=1&height=430";u=p.default.createElement(g.default,{src:d,width:"auto",height:"450",position:""})}return u}},{key:"mediaBlockRenderer",value:function(e){if("atomic"===e.getType())return{component:this.media,editable:!1,props:{foo:"bar"}}}},{key:"render",value:function(){var e=this,t=this.state,n=t.editorState,r=(t.readOnly,t.rendered),o=t.placeholder,a=t.expandControl,i=this.props.displayControls;return p.default.createElement("div",{className:"RichEditor-editor"},p.default.createElement("div",{ref:"draftHtml",style:{display:"none"}},r),i?p.default.createElement(P,{editorState:n,toggleBlockType:this.toggleBlockType,toggleInlineStyle:this.toggleInlineStyle,addImage:this.addImage,addLink:this.addLink,updateImage:this.updateImage,expandControl:a,handleExpandControl:function(){e.setState({expandControl:!e.state.expandControl})}}):null,p.default.createElement(y.Editor,{blockRendererFn:this.mediaBlockRenderer,editorState:n,blockStyleFn:u,onChange:this.onChange,handleKeyCommand:this.handleKeyCommand,keyBindingFn:this.mapKeyToEditorCommand,placeholder:o,ref:"editor",stripPastedStyles:!0,spellCheck:!0}))}}]),t}(p.default.Component),c.defaultProps={displayControls:!0,syncContent:null,content:"",readOnly:!1,getEditor:function(e){},placeholder:"请输入正文",getCheckUpload:function(){}},s);t.default=x},1245:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(1),c=r(l),s=n(78),f=r(s),d=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.src!==e.src}},{key:"render",value:function(){var e=this.props,t=e.src,n=e.width,r=void 0===n?"auto":n,o=e.height,a=void 0===o?"auto":o;return c.default.createElement("iframe",{ref:"iframe",src:t,width:r,height:a})}}]),t}(c.default.Component);d.propTypes={src:f.default.string.isRequired},e.exports=d},1246:function(e,t){},1247:function(e,t){},1316:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(o,a){try{var i=t[o](a),u=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}return r("next")})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l,c,s,f,d,p=function(){function e(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),y=n(1),m=r(y),v=n(288),b=n(115),g=n(185),k=n(491),_=n(505),w=n(289),E=n(1221),C=r(E),O=n(1317),P=r(O),S=n(1244),T=r(S),j=n(135),x=r(j),N=n(1318),R=r(N),M=(l=(0,g.connect)(function(e,t){return{topicList:(0,w.getTopicListByName)(e,"new-posts")}},function(e){return{addPosts:(0,b.bindActionCreators)(k.addPosts,e),loadTopics:(0,b.bindActionCreators)(_.loadTopics,e),updatePosts:(0,b.bindActionCreators)(k.updatePosts,e)}}),c=(0,x.default)(R.default),l(s=c((d=f=function(e){function t(e){a(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e._id,o=(e.type,e.topic_id),u=e.title,l=e.content,c=e.content_html,s=e.successCallback;return n.state={_id:r||"",title:u||"",contentStateJSON:l||"",contentHTML:c||"",topic:o||null,displayTopicsContainer:!1,editor:m.default.createElement("div",null),successCallback:s,loading:!1,editorElement:null},n.submit=n.submit.bind(n),n.titleChange=n.titleChange.bind(n),n.handleContentChange=n.handleContentChange.bind(n),n.selectedTopic=n.selectedTopic.bind(n),n.showTopicContainer=n.showTopicContainer.bind(n),n}return u(t,e),h(t,[{key:"componentDidMount",value:function(){var e=this,t=this.state,n=t._id,r=(t.type,t.title),o=t.contentStateJSON,a=this.props,i=a.topicList,u=a.loadTopics;if(i.data||u({id:"new-posts",filters:{variables:{parent_id:"not-exists",page_size:1e3}}}),n)var l=o,c=r;else var l=v.reactLocalStorage.get("posts-content")||"",c=v.reactLocalStorage.get("posts-title")||"";this.setState({editor:m.default.createElement("div",null,m.default.createElement(T.default,{syncContent:this.handleContentChange,content:l,placeholder:"请输入正文",expandControl:!0,getEditor:function(t){e.setState({editorElement:t})},getCheckUpload:function(t){e.checkUpload=t}}))}),this.refs.title.value=c}},{key:"titleChange",value:function(e){if(!this.state._id){var t=this.refs.title;v.reactLocalStorage.set("posts-title",t.value)}}},{key:"handleContentChange",value:function(e,t){this.state.contentStateJSON=e,this.state.contentHTML=t,this.state._id||v.reactLocalStorage.set("posts-content",e)}},{key:"submit",value:function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){var t,n,r,o,a,i,u,l,c,s,f,d,h,y,m,b,g,k,_,w,E;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,n=this.refs.title,r=this.props,o=r.addPosts,a=r.updatePosts,i=this.state,u=i.loading,l=i._id,c=i.topic,s=i.contentStateJSON,f=i.contentHTML,d=i.successCallback,h=i.editorElement,!u){e.next=6;break}return e.abrupt("return");case 6:if(c){e.next=8;break}return e.abrupt("return",alert("您还未选择话题"));case 8:if(n.value){e.next=10;break}return e.abrupt("return",n.focus());case 10:if(this.checkUpload()){e.next=13;break}return Toastify({text:"有图片上传中，请等待上传完成后再提交",duration:3e3,backgroundColor:"linear-gradient(to right, #0988fe, #1c75fb)"}).showToast(),e.abrupt("return");case 13:if(t.setState({loading:!0}),!l){e.next=24;break}return e.next=17,(0,P.default)(a({id:l,topicId:c._id,topicName:c.name,title:n.value,detail:s,detailHTML:f}));case 17:return y=e.sent,m=p(y,2),b=m[0],g=m[1],t.setState({loading:!1}),d(g),e.abrupt("return");case 24:return e.next=26,o({title:n.value,detail:s,detailHTML:f,topicId:c._id,device:parseInt(C.default.getCurrentDeviceId()),type:1});case 26:k=e.sent,_=p(k,2),w=_[0],E=_[1],E&&E.success?(setTimeout(function(){v.reactLocalStorage.set("posts-content",""),v.reactLocalStorage.set("posts-title","")},200),setTimeout(function(){t.setState({loading:!1}),d(E),Toastify({text:"提交成功",duration:3e3,backgroundColor:"linear-gradient(to right, #50c64a, #40aa33)"}).showToast()},1500)):(t.setState({loading:!1}),Toastify({text:w.message,duration:3e3,backgroundColor:"linear-gradient(to right, #ff6c6c, #f66262)"}).showToast());case 31:case"end":return e.stop()}},e,this)}));return e}()},{key:"selectedTopic",value:function(e){this.setState({topic:e}),this.showTopicContainer()}},{key:"showTopicContainer",value:function(){this.setState({displayTopicsContainer:!this.state.displayTopicsContainer})}},{key:"render",value:function(){var e=this,t=this.state,n=t.editor,r=t.topic,o=t.displayTopicsContainer,a=t.loading,i=this.props.topicList,u=[],l={};if(i.data)for(var c=0,s=i.data.length;c<s;c++){var f=i.data[c];f.parent_id?(l[f.parent_id]||(l[f.parent_id]=[]),l[f.parent_id].push(f)):u.push(f)}return m.default.createElement("div",null,m.default.createElement("div",null,o?m.default.createElement("div",{styleName:"node-selector"},m.default.createElement("div",{styleName:"mask",onClick:this.showTopicContainer}),m.default.createElement("div",{styleName:"topics-container"},m.default.createElement("div",null,m.default.createElement("span",{styleName:"close",onClick:this.showTopicContainer}),m.default.createElement("b",null,"请选择一个话题")),i.data.map(function(t){return m.default.createElement("div",{key:t._id},m.default.createElement("div",{styleName:"head"},t.name),m.default.createElement("div",null,t.children&&t.children.map(function(t){return m.default.createElement("div",{key:t._id,styleName:r&&r._id==t._id?"active":"topic",onClick:function(){e.selectedTopic(t)}},t.name)})))}))):null,m.default.createElement("div",{className:"container"},m.default.createElement("div",{className:"row"},m.default.createElement("div",{className:"col-md-2"},m.default.createElement("div",{styleName:"choose-topic-button",onClick:this.showTopicContainer},r?r.name:"选择话题")),m.default.createElement("div",{className:"col-md-10"},m.default.createElement("input",{styleName:"title",ref:"title",type:"text",onChange:this.titleChange,placeholder:"请输入标题"})))),m.default.createElement("div",{styleName:"editor"},n),m.default.createElement("button",{styleName:"button",onClick:this.submit},a?"提交中...":"提交")))}}]),t}(m.default.Component),f.defaultProps={type:1,topic_id:null,_id:null,title:"",content:"",successCallback:function(){}},s=d))||s)||s);t.default=M},1317:function(e,t,n){"use strict";function r(e){return e&&Promise.prototype.isPrototypeOf(e)?e.then(function(e){return[null,e]}).catch(function(e){return[e]}):new Promise(function(e,t){t(new Error("requires promises as the param"))}).catch(function(e){return[e,null]})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},1318:function(e,t){e.exports={"node-selector":"_3y33zPwJ","topics-container":"_1c6lkktV",close:"nuxFK9TB",head:"_1o4SHCZ4",topic:"_2gHY2c5V",active:"_1k4pX-Mh",mask:"_2WPS3iA-","choose-topic-button":"_12Mql5UI",title:"_3ZVq0XKh",editor:"_2sk9thBg",button:"_2mRIwHW5"}}});